<head>
    <meta charset="utf-8">
    <style type="text/css">
        .tftable {
            font-size: 16px;
            color: #333333;
            width: 100%;
            border-width: 1px;
            border-color: #bcaf91;
            border-collapse: collapse;
        }

        .tftable th {
            font-size: 16px;
            background-color: #e0e0e0;
            border-width: 1px;
            padding: 8px;
            border-style: solid;
            border-color: #bcaf91;
            text-align: left;
        }

        .tftable tr {
            background-color: #ffffff;
        }

        .tftable td {
            font-size: 12px;
            border-width: 1px;
            padding: 8px;
            border-style: solid;
            border-color: #bcaf91;
        }

        .tftable tr:hover {
            background-color: #ffff99;
        }

        .hidden {
            display: none;
        }

    </style>
</head>

{% load staticfiles %}

<script src="{% static 'js/Chart.js' %}"></script>
{% if solve.is_valid %}

    <p>Ваша генеральная совокупность: {{ solve.numbers }}<br>
        Количество чисел: \(n = {{ solve.number_of_values }}\)<br>
        Шаг: \(h = {{ solve.step }}\)</p>

    <table class="tftable" border="1">
        <tr>
            <th>№</th>
            <th>\(x_{i}\)</th>
            <th>\(k_{i}\)</th>
            <th>\(z_{i}\)</th>
            <th>\(z_{i+1}\)</th>
            <th>\(n_{i}\)</th>
            <th>\(\frac{n_{i}}{h}\)</th>
            <th>\(\frac{n_{i}}{h\cdot n}\)</th>
            <th>\(z_{i}*\)</th>
        </tr>
    </table>

    <canvas id="graph-1"></canvas>
    <canvas id="graph-2"></canvas>
    <canvas id="graph-3"></canvas>
    <canvas id="graph-4"></canvas>
    <div><p style="font-size: 16px">На основании графиков предположите тип распределения: </p></div>
    <form class="form-horizontal" style="padding-left: 25px" name="dist">
        <div class="form-group">
            <input type="radio" id="norm" name="type" checked>
            <label for="norm">Нормальное распределение</label>
        </div>
        <div class="form-group">
            <input type="radio" id="even" name="type">
            <label for="even">Равномерное распределение</label>
        </div>

        <div class="form-group">
            <input type="radio" id="exp" name="type">
            <label for="exp">Показательное распределение</label>
        </div>

        <input type="submit" class="btn btn-success" value="Перейти к дальнейшим вычислениям">
    </form>

    <div class="hidden norm dist">
        <p>Нормальное распределение</p>
    </div>
    <div class="hidden even dist">
        <h4>Равномерное распределение</h4>
        <p><font size="4">
            $$  f(x) = \left\{\begin{matrix} 0, & x	&#60;a \\ \frac{1}{b-a}, & a\leq x\leq b \\ 0, & x>b\end{matrix}\right.  $$
        Используем ММП метод:<br>
        \( a\approx \frac{n}{n-1}\cdot x_{(1)} - \frac{1}{n-1}\cdot x_{n} \approx {{ solve.ravn_a }}  \)<br>
        \( b\approx \frac{n}{n-1}\cdot x_{(n)} - \frac{1}{n-1}\cdot x_{1} \approx {{ solve.ravn_b }}  \)<br>
        Построим доверительный интервал:</font></p>
    </div>
    <div class="hidden exp dist">
        <p>Показательное распределение</p>
    </div>

    <script>
        document.forms['dist'].addEventListener('submit', function (event) {
            event.preventDefault();
            [].slice.call(document.querySelectorAll('.dist')).forEach(function (e) {
                if (!e.classList.contains('hidden')) {
                    e.classList.add('hidden');
                }
            });

            [].slice.call(this.querySelectorAll('[name=type]')).forEach(function (e) {
                if (e.checked) {
                    document.querySelector(`.${e.id}`).classList.toggle('hidden');
                }
            });
        })
    </script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            let table = document.querySelector('.tftable');
            let uniqueNumbers = {{ solve.unique_numbers }},
                zi = {{ solve.grid_gist }},
                counts = {{ solve.counts }},
                gistValues = {{ solve.gist_values }},
                index_polygon = {{ solve.index_polygon }},
                step = '{{ solve.step }}'.replace(',', '.'),
                numberOfValues = {{ solve.number_of_values }};


            for (let i = 0; i < uniqueNumbers.length; i++) {
                let row = document.createElement('tr');
                row.innerHTML =
                    `<td>${i + 1}</td>
                <td>${uniqueNumbers[i]}</td>
                <td>${counts[i]}</td>
                <td>${(zi[i + 1] === undefined) ? `---` : zi[i]}</td>
                <td>${(zi[i + 1] === undefined) ? `---` : zi[i + 1]}</td>
                <td>${(gistValues[i] === undefined) ? `---` : gistValues[i]}</td>
                <td>${(isNaN(gistValues[i] / step)) ? `---` : ((gistValues[i] / step).toFixed(2))}</td>
                <td>${(isNaN(gistValues[i] / step / numberOfValues)) ? '---' : ((gistValues[i] / step / numberOfValues).toFixed(2))}</td>
                <td>${(index_polygon[i] === undefined) ? `---` : index_polygon[i]}</td>`;
                table.append(row);
            }

        });
    </script>


    <script type="text/javascript">

        new Chart(document.getElementById("graph-1").getContext('2d'), {
            type: 'line',
            // showTooltips: false,
            data: {
                labels: {{ solve.index }},
                datasets: [{
                    label: '',
                    data: {{ solve.numbers }},
                    borderColor: 'rgba(93,133,245, 1)',
                    borderWidth: 3,
                    fill: false,
                    // steppedLine: false,
                    lineTension: 0,
                    pointBackgroundColor: 'white',
                    pointBorderColor: 'black',
                    pointBorderWidth: 1,
                    pointRadius: 3,
                    pointHoverBackgroundColor: 'black',
                    showLine: true,
                }]
            },
            options: {
                legend: false,
                responsive: true,
                title: {
                    display: true,
                    text: 'Первичная статистическая обработка'
                },
                scales: {
                    xAxes: {
                        display: true,
                        type: 'linear',
                    },
                    yAxes: {
                        display: true,
                        type: 'linear',
                    },
                }
            }
        });


        new Chart(document.getElementById("graph-2").getContext('2d'), {
            type: 'line',
            data: {
                labels: {{ solve.index }},
                datasets: [{
                    data: {{ solve.numbers_sort }},
                    borderColor: 'rgba(93,133,245, 1)',
                    borderWidth: 3,
                    fill: false,
                    // steppedLine: false,
                    lineTension: 0,
                    pointBackgroundColor: 'white',
                    pointBorderColor: 'black',
                    pointBorderWidth: 1,
                    pointRadius: 3,
                    pointHoverBackgroundColor: 'black',
                    showLine: true,
                }]
            },
            options: {
                legend: false,
                responsive: true,
                title: {
                    display: true,
                    text: 'Вариационный график'
                },
                scales: {
                    xAxes: [{
                        display: true,
                    }],
                    yAxes: [{
                        display: true,
                    }]
                }
            }
        });

        new Chart(document.getElementById("graph-3").getContext('2d'), {
                type: 'line',
                data: {
                    labels: {{ solve.index_efr }},
                    datasets: [{
                        label: 'ЭФР',
                        data: {{ solve.efr }},
                        borderColor: 'rgba(93,133,245, 1)',
                        borderWidth: 3,
                        fill: false,
                        steppedLine: true,
                        lineTension: 0,
                        pointBackgroundColor: 'white',
                        pointBorderColor: 'black',
                        pointBorderWidth: 1,
                        pointRadius: 1,
                        pointHoverBackgroundColor: 'black',
                        showLine: true,
                    }]
                },
                options: {
                    legend: false,
                    responsive: true,
                    title: {
                        display: true,
                        text: 'Эмпирическая функция распределения (ЭФР)'
                    },
                    scales: {
                        xAxes: [{
                            display: true,
                        }],
                        yAxes: [{
                            display: true,
                        }]
                    }
                }
            }
        );

        new Chart(document.getElementById("graph-4").getContext('2d'), {
            type: 'bar',
            data: {
                labels: {{ solve.index_polygon }},
                datasets: [{
                    type: 'line',
                    data: {{ solve.gist }},
                    borderColor: 'rgba(93,133,245, 1)',
                    borderWidth: 3,
                    fill: false,
                    // steppedLine: false,
                    lineTension: 0,
                    pointBackgroundColor: 'white',
                    pointBorderColor: 'black',
                    pointBorderWidth: 1,
                    pointRadius: 3,
                    pointHoverBackgroundColor: 'black',
                    showLine: true,
                }, {
                    type: 'bar',
                    data: {{ solve.gist }},
                    borderColor: 'rgba(93,133,245, 1)',
                    borderWidth: 3,
                    fill: false,
                    // steppedLine: false,
                    lineTension: 0,
                    pointBackgroundColor: 'white',
                    pointBorderColor: 'black',
                    pointBorderWidth: 1,
                    pointRadius: 3,
                    pointHoverBackgroundColor: 'black',
                    showLine: true,
                }]
            },
            options: {
                legend: false,
                responsive: true,
                title: {
                    display: true,
                    text: 'Гистограмма и полигон'
                },
                scales: {
                    xAxes: [{
                        display: true,
                        barThickness: 60,
                    }],
                    yAxes: [{
                        display: true,
                    }]
                }
            }
        });

    </script>

{% else %}

    <form action="{{ task.get_absolute_url }}" method="get">
        <div class="form-group">
        <textarea class="form-control"
                  placeholder="Введите генеральную совокупность, состоящую из случайных величин: "
                  name="numbers" required="" maxlength="1000" rows="4"></textarea>
        </div>
        <button class="btn btn-success" type="submit">Получить решение!</button>
    </form>

{% endif %}
