<head>
    <meta charset="utf-8">
    <style type="text/css">
        .tftable {
            font-size: 16px;
            color: #333333;
            width: 100%;
            border-width: 1px;
            border-color: #bcaf91;
            border-collapse: collapse;
        }

        .tftable th {
            font-size: 16px;
            background-color: #e0e0e0;
            border-width: 1px;
            padding: 8px;
            border-style: solid;
            border-color: #bcaf91;
            text-align: left;
        }

        .tftable tr {
            background-color: #ffffff;
        }

        .tftable td {
            font-size: 12px;
            border-width: 1px;
            padding: 8px;
            border-style: solid;
            border-color: #bcaf91;
        }

        .tftable tr:hover {
            background-color: #ffff99;
        }

        .hidden {
            display: none;
        }

    </style>
</head>

{% load staticfiles %}
<script src="{% static 'js/Chart.js' %}"></script>
{% if solve.is_valid %}

    <p> Количество чисел: \(n = {{ solve.number_of_values }}\) <br>
        Шаг: \(h = {{ solve.step }}\) <br></p>

    <h4>Ваша генеральная совокупность:</h4>
    <table class="tftable" id="table3" border="1">
    </table>

    <h4>После сортировки:</h4>
    <table class="tftable" id="table4" border="1">
    </table><br>

    <table class="tftable" id="table1" border="1">
        <tr>
            <th>№</th>
            <th>\(z_{i}\)</th>
            <th>\(z_{i+1}\)</th>
            <th>\(n_{i}\)</th>
            <th>\(\frac{n_{i}}{h}\)</th>
            <th>\(\frac{n_{i}}{h\cdot n}\)</th>
            <th>\(z_{i}^{\ast}\)</th>
        </tr>
    </table><br><br>

    <canvas id="graph-1"></canvas>
    <canvas id="graph-2"></canvas>
    <canvas id="graph-3"></canvas>
    <canvas id="graph-4"></canvas>
    <div id="select-visible-type-of-dist"><p style="font-size: 16px">На основании графиков предположите тип
        распределения: </p>
        <form class="form-horizontal" style="padding-left: 25px" name="dist">
            <div class="form-group">
                <input type="radio" id="norm" name="type" checked>
                <label for="norm">Нормальное распределение</label>
            </div>
            <div class="form-group">
                <input type="radio" id="even" name="type">
                <label for="even">Равномерное распределение</label>
            </div>

            <div class="form-group">
                <input type="radio" id="exp" name="type">
                <label for="exp">Показательное распределение</label>
            </div>

            <input type="submit" class="btn btn-success" value="Перейти к дальнейшим вычислениям">
        </form>
    </div>
    <div class="hidden norm dist">
        <p>Нормальное распределение</p>
    </div>
    <div class="hidden even dist">
        <h4>Равномерное распределение:</h4>
        <p>
            $$ f(x) = \left\{\begin{matrix} 0, & x &#60;a \\ \frac{1}{b-a}, & a\leq x\leq b \\ 0, &
            x>b\end{matrix}\right. $$
            Используем ММП метод:
            $$ a\approx \frac{n}{n-1}\cdot x_{(1)} - \frac{1}{n-1}\cdot x_{n} \approx {{ solve.ravn_a }} $$
            $$ b\approx \frac{n}{n-1}\cdot x_{(n)} - \frac{1}{n-1}\cdot x_{1} \approx {{ solve.ravn_b }} $$
            Построим доверительный интервал:
            $$ x_{(1)} - l\cdot (1-\alpha^\frac{1}{n}) &#60; a &#60; x_{(1)} ,$$
            $$ x_{(n)} &#60; b &#60; x_{(n)} + l\cdot (1-\alpha^\frac{1}{n}) ,$$
            где \( \alpha \ - \) уровень значимости, \( (1 - \alpha) \ - \) надежность, \( l = x_{(n)} - x_{(1)} \)
            $$ {{ solve.ravn_levo_a }} &#60; a &#60; {{ solve.min }} $$
            $$ {{ solve.max }} &#60; b &#60; {{ solve.ravn_pravo_b }} $$
            Проверяем гипотезу по критерию Пирсона:<br>
            Для равномерного распределения:
            $$ P(\alpha &#60; \xi &#60; \beta) = \frac{\beta - \alpha}{b - a} $$
            Статистика Пирсона:
            $$ W = \sum \frac{(n_i - n_i^T)^2}{n_i^T} = \sum \frac{n_i^2}{n_i^T} - n ,$$
            где \( n_i^T = n\cdot p_i \)
        </p>
        <table class="tftable" id="table2" border="1">
            <tr>
                <th>№</th>
                <th>\(x_{i}\)</th>
                <th>\(x_{i+1}\)</th>
                <th>\(x_{i}^{\ast} \)</th>
                <th>\(n_{i}\)</th>
                <th>\(p_{i}\)</th>
                <th>\(\ n_{i}^T = n\cdot p_{i}\)</th>
                <th>\(\frac{n_{i}^2}{n_{i}^T}\)</th>
            </tr>
        </table>
        <p>
            Следовательно:
            $$ W \approx {{ solve.ravn_w }} $$
            Найдем $$ W_{кр} = \chi_{1-\alpha}^2(k - 1 - l) =
            \chi_{ {{ solve.nadezhnost }} }^2( {{ solve.number_of_intervals }} - 1 - {{ solve.l_ravn }} ) =
            {{ solve.ravn_wkr }} ,$$
            где \(k - \) количество интервалов разбиения, \(l - \) количество параметров распределения.
            {{ solve.ravn_answer }}
        </p>
    </div>
    <div class="hidden exp dist">
        <h4>Показательное распределение:</h4>
        <p>
            $$ f(x) = \left\{\begin{matrix} \lambda\cdot e^{-\lambda x}, & x \ge 0 \\ 0, & x\lt 0 \end{matrix}\right. $$
            Используем ММП метод:
            $$ \bar x = \frac{1}{n} \sum_{i=1}^k n_i x_i^{\ast} \approx {{ solve.pokaz_x }} $$
            $$ \hat \lambda = \frac{1}{\bar x} \approx {{ solve.pokaz_lambda }}$$
            Построим доверительный интервал:
            $$ \frac{1}{\bar x} \left ( 1 - \frac{\lambda_{1-\frac{\alpha}{2}}}{\sqrt{n}} \right ) &#60; \lambda &#60;
            \frac{1}{\bar x} \left ( 1 + \frac{\lambda_{1-\frac{\alpha}{2}}}{\sqrt{n}} \right ) ,$$
            где \( \alpha \ - \) уровень значимости, \( (1 - \alpha) \ - \) надежность
            $$ {{ solve.pokaz_levo_lambda }} &#60; \lambda &#60; {{ solve.pokaz_pravo_lambda }} $$
            Проверяем гипотезу по критерию Пирсона:<br>
            Для показательного распределения:
            $$ P(\alpha &#60; \xi &#60; \beta) = e^{-\lambda \alpha} - e^{-\lambda \beta} $$
            Статистика Пирсона:
            $$ W = \sum \frac{(n_i - n_i^T)^2}{n_i^T} = \sum \frac{n_i^2}{n_i^T} - n ,$$
            где \( n_i^T = n\cdot p_i \)
        </p>
        <table class="tftable" id="table5" border="1">
            <tr>
                <th>№</th>
                <th>\(x_{i}\)</th>
                <th>\(x_{i+1}\)</th>
                <th>\(x_{i}^{\ast} \)</th>
                <th>\(n_{i} \)</th>
                <th>\(x_{i}^{\ast}\cdot n_i \)</th>
                <th>\( e^{-\lambda x_{i}} \)</th>
                <th>\( e^{-\lambda x_{i+1}} \)</th>
                <th>\(p_{i}\)</th>
                <th>\(\ n_{i}^T = n\cdot p_{i}\)</th>
                <th>\(\frac{n_{i}^2}{n_{i}^T}\)</th>
            </tr>
        </table>
        <p>
            Следовательно:
            $$ W \approx {{ solve.pokaz_w }} $$
            Найдем $$ W_{кр} = \chi_{1-\alpha}^2(k - 1 - l) =
            \chi_{ {{ solve.nadezhnost }} }^2( {{ solve.number_of_intervals }} - 1 - {{ solve.l_pokaz }} ) =
            {{ solve.pokaz_wkr }} ,$$
            где \(k - \) количество интервалов разбиения, \(l - \) количество параметров распределения.
            {{ solve.pokaz_answer }}
        </p>

    </div>

    <button id="save-to-pdf" class="btn btn-success" style="margin: 10px 12px;">Сохранить в pdf</button>

    <script>
        document.querySelector('#save-to-pdf').addEventListener('click', function () {
            document.querySelector('.task-description').classList.add('ignore-to-pdf');
            document.querySelector('#select-visible-type-of-dist').classList.add('ignore-to-pdf');
            this.classList.add('ignore-to-pdf');
            [].slice.call(document.querySelectorAll('hr')).forEach(function (e) {
                e.classList.add('ignore-to-pdf');
            });

            document.querySelector('header').classList.add('ignore-to-pdf');
            [].slice.call(document.querySelectorAll('navigation')).forEach(function (value) {
                value.classList.add('ignore-to-pdf');
            });

            let mainBlock = document.querySelector('.main-block');
            mainBlock.classList.remove('col-md-8');
            mainBlock.classList.add('col-md-12');
            document.querySelector('main').classList.remove('top-main');

            console.log(mainBlock.classList);

            document.querySelector('footer').classList.add('ignore-to-pdf');
            document.querySelector('.post').style.fontSize = '18px';


            new Promise((resolve) => {
                print();
                resolve();
            }).then(() => {
                mainBlock.classList.remove('col-md-12');
                mainBlock.classList.add('col-md-8');
                document.querySelector('main').classList.add('top-main');
                document.querySelector('.post').style.fontSize = '14px';
            });


        });

    </script>

    <script>
        document.forms['dist'].addEventListener('submit', function (event) {
            event.preventDefault();
            [].slice.call(document.querySelectorAll('.dist')).forEach(function (e) {
                if (!e.classList.contains('hidden')) {
                    e.classList.add('hidden');
                }
            });

            [].slice.call(this.querySelectorAll('[name=type]')).forEach(function (e) {
                if (e.checked) {
                    document.querySelector(`.${e.id}`).classList.toggle('hidden');
                }
            });
        })
    </script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            let table1 = document.querySelector('#table1');
            let table2 = document.querySelector('#table2');
            let table5 = document.querySelector('#table5');
            let uniqueNumbers = {{ solve.unique_numbers }},
                zi = {{ solve.grid_gist }},
                counts = {{ solve.counts }},
                gistValues = {{ solve.gist_values }},
                index_polygon = {{ solve.index_polygon }},
                step = '{{ solve.step }}'.replace(',', '.'),
                numberOfValues = {{ solve.number_of_values }},
                ravnPi = {{ solve.ravn_p }},
                pokazPi = {{ solve.pokaz_p }},
                pokazLambda = '{{ solve.pokaz_lambda }}'.replace(',', '.');


            for (let i = 0; i < zi.length - 1; i++) {
                let row1 = document.createElement('tr');
                row1.innerHTML =
                    `<td>${i + 1}</td>
                <td>${(zi[i + 1] === undefined) ? `---` : zi[i]}</td>
                <td>${(zi[i + 1] === undefined) ? `---` : zi[i + 1]}</td>
                <td>${(gistValues[i] === undefined) ? `---` : gistValues[i]}</td>
                <td>${(isNaN(gistValues[i] / step)) ? `---` : ((gistValues[i] / step).toFixed(2))}</td>
                <td>${(isNaN(gistValues[i] / step / numberOfValues)) ? '---' : ((gistValues[i] / step / numberOfValues).toFixed(2))}</td>
                <td>${(index_polygon[i] === undefined) ? `---` : index_polygon[i]}</td>`;
                table1.append(row1);
            }

            for (let i = 0; i < zi.length - 1; i++) {
                let row2 = document.createElement('tr');
                row2.innerHTML =
                    `<td>${i + 1}</td>
                     <td>${(zi[i + 1] === undefined) ? `---` : zi[i]}</td>
                     <td>${(zi[i + 1] === undefined) ? `---` : zi[i + 1]}</td>
                     <td>${(index_polygon[i] === undefined) ? `---` : index_polygon[i]}</td>
                     <td>${(gistValues[i] === undefined) ? `---` : gistValues[i]}</td>
                     <td>${ravnPi[i]}</td>
                     <td>${(numberOfValues * ravnPi[i]).toFixed(2)}</td>
                     <td>${(gistValues[i] === undefined) ? `---` : ((gistValues[i]) * (gistValues[i]) / numberOfValues / ravnPi[i]).toFixed(2)}</td>`;
                table2.append(row2);
            }

            for (let i = 0; i < zi.length - 1; i++) {
                let row5 = document.createElement('tr');
                row5.innerHTML =
                    `<td>${i + 1}</td>
                <td>${(zi[i + 1] === undefined) ? `---` : zi[i]}</td>
                <td>${(zi[i + 1] === undefined) ? `---` : zi[i + 1]}</td>
                <td>${(index_polygon[i] === undefined) ? `---` : index_polygon[i]}</td>
                <td>${(gistValues[i] === undefined) ? `---` : gistValues[i]}</td>
                <td>${(index_polygon[i] === undefined) ? `---` : (index_polygon[i] * gistValues[i]).toFixed(2)}</td>
                <td>${(Math.exp(-pokazLambda * zi[i])).toFixed(2)}</td>
                <td>${(Math.exp(-pokazLambda * zi[i + 1])).toFixed(2)}</td>
                <td>${pokazPi[i].toFixed(2)}</td>
                <td>${(numberOfValues * pokazPi[i]).toFixed(2)}</td>
                <td>${(gistValues[i] === undefined) ? `---` : ((gistValues[i]) * (gistValues[i]) / numberOfValues / pokazPi[i]).toFixed(2)}</td>`;
                table5.append(row5);
            }

        });

        document.addEventListener('DOMContentLoaded', function () {
            let table1 = document.querySelector('#table3');
            let numbers = {{ solve.numbers }};


            for (let i = 0; i < numbers.length; i += 10) {
                let row = document.createElement('tr');
                row.innerHTML =
                    `<td>${(numbers[i] === undefined) ? `---` : numbers[i]}</td>
                     <td>${(numbers[i + 1] === undefined) ? `---` : numbers[i + 1]}</td>
                     <td>${(numbers[i + 2] === undefined) ? `---` : numbers[i + 2]}</td>
                     <td>${(numbers[i + 3] === undefined) ? `---` : numbers[i + 3]}</td>
                     <td>${(numbers[i + 4] === undefined) ? `---` : numbers[i + 4]}</td>
                     <td>${(numbers[i + 5] === undefined) ? `---` : numbers[i + 5]}</td>
                     <td>${(numbers[i + 6] === undefined) ? `---` : numbers[i + 6]}</td>
                     <td>${(numbers[i + 7] === undefined) ? `---` : numbers[i + 7]}</td>
                     <td>${(numbers[i + 8] === undefined) ? `---` : numbers[i + 8]}</td>
                     <td>${(numbers[i + 9] === undefined) ? `---` : numbers[i + 9]}</td>`;
                table1.append(row);
            }

        });


        document.addEventListener('DOMContentLoaded', function () {
            let table = document.querySelector('#table4');
            let numbers_sort = {{ solve.numbers_sort }};


            for (let i = 0; i < numbers_sort.length; i += 10) {
                let row = document.createElement('tr');
                row.innerHTML =
                    `<td>${numbers_sort[i]}</td>
                    <td>${numbers_sort[i + 1]}</td>
                     <td>${numbers_sort[i + 2]}</td>
                       <td>${numbers_sort[i + 3]}</td>
                        <td>${numbers_sort[i + 4]}</td>
                    <td>${numbers_sort[i + 5]}</td>
                    <td>${numbers_sort[i + 6]}</td>
                     <td>${numbers_sort[i + 7]}</td>
                       <td>${numbers_sort[i + 8]}</td>
                        <td>${numbers_sort[i + 9]}</td>`;
                table.append(row);
            }

        });
    </script>


    <script type="text/javascript">

        new Chart(document.getElementById("graph-1").getContext('2d'), {
            type: 'line',
            // showTooltips: false,
            data: {
                labels: {{ solve.index }},
                datasets: [{
                    label: '',
                    data: {{ solve.numbers }},
                    borderColor: 'rgba(93,133,245, 1)',
                    borderWidth: 3,
                    fill: false,
                    // steppedLine: false,
                    lineTension: 0,
                    pointBackgroundColor: 'white',
                    pointBorderColor: 'black',
                    pointBorderWidth: 1,
                    pointRadius: 3,
                    pointHoverBackgroundColor: 'black',
                    showLine: true,
                }]
            },
            options: {
                legend: false,
                responsive: true,
                title: {
                    display: true,
                    text: 'Первичная статистическая обработка'
                },
                scales: {
                    xAxes: {
                        display: true,
                        type: 'linear',
                    },
                    yAxes: {
                        display: true,
                        type: 'linear',
                    },
                }
            }
        });


        new Chart(document.getElementById("graph-2").getContext('2d'), {
            type: 'line',
            data: {
                labels: {{ solve.index }},
                datasets: [{
                    data: {{ solve.numbers_sort }},
                    borderColor: 'rgba(93,133,245, 1)',
                    borderWidth: 3,
                    fill: false,
                    // steppedLine: false,
                    lineTension: 0,
                    pointBackgroundColor: 'white',
                    pointBorderColor: 'black',
                    pointBorderWidth: 1,
                    pointRadius: 3,
                    pointHoverBackgroundColor: 'black',
                    showLine: true,
                }]
            },
            options: {
                legend: false,
                responsive: true,
                title: {
                    display: true,
                    text: 'Вариационный график'
                },
                scales: {
                    xAxes: [{
                        display: true,
                    }],
                    yAxes: [{
                        display: true,
                    }]
                }
            }
        });

        new Chart(document.getElementById("graph-3").getContext('2d'), {
                type: 'line',
                data: {
                    labels: {{ solve.index_efr }},
                    datasets: [{
                        label: 'ЭФР',
                        data: {{ solve.efr }},
                        borderColor: 'rgba(93,133,245, 1)',
                        borderWidth: 3,
                        fill: false,
                        steppedLine: true,
                        lineTension: 0,
                        pointBackgroundColor: 'white',
                        pointBorderColor: 'black',
                        pointBorderWidth: 1,
                        pointRadius: 1,
                        pointHoverBackgroundColor: 'black',
                        showLine: true,
                    }]
                },
                options: {
                    legend: false,
                    responsive: true,
                    title: {
                        display: true,
                        text: 'Эмпирическая функция распределения (ЭФР)'
                    },
                    scales: {
                        xAxes: [{
                            display: true,
                        }],
                        yAxes: [{
                            display: true,
                        }]
                    }
                }
            }
        );

        new Chart(document.getElementById("graph-4").getContext('2d'), {
            type: 'bar',
            data: {
                labels: {{ solve.index_polygon }},
                datasets: [{
                    type: 'line',
                    data: {{ solve.gist }},
                    borderColor: 'rgba(93,133,245, 1)',
                    borderWidth: 3,
                    fill: false,
                    // steppedLine: false,
                    lineTension: 0,
                    pointBackgroundColor: 'white',
                    pointBorderColor: 'black',
                    pointBorderWidth: 1,
                    pointRadius: 3,
                    pointHoverBackgroundColor: 'black',
                    showLine: true,
                }, {
                    type: 'bar',
                    data: {{ solve.gist }},
                    borderColor: 'rgba(93,133,245, 1)',
                    borderWidth: 3,
                    fill: false,
                    // steppedLine: false,
                    lineTension: 0,
                    pointBackgroundColor: 'white',
                    pointBorderColor: 'black',
                    pointBorderWidth: 1,
                    pointRadius: 3,
                    pointHoverBackgroundColor: 'black',
                    showLine: true,
                }]
            },
            options: {
                legend: false,
                responsive: true,
                title: {
                    display: true,
                    text: 'Гистограмма и полигон'
                },
                scales: {
                    xAxes: [{
                        display: true,
                        barThickness: 60,
                    }],
                    yAxes: [{
                        display: true,
                    }]
                }
            }
        });

    </script>

{% else %}

    <form action="{{ task.get_absolute_url }}" method="get">
        <div class="form-group">
        <textarea class="form-control"
                  placeholder="Введите генеральную совокупность, состоящую из случайных величин: "
                  name="numbers" required="" maxlength="1000" rows="4"></textarea>
        </div>
        <label for="1-alpha">Введите надежность: </label>
        <input type="text" id="1-alpha" name="1-alpha">
        <button class="btn btn-success" type="submit">Получить решение!</button>
    </form>

{% endif %}